/*
    -------------------------------------------------------------------
    Velisoft Image Library
    Author: Velisoft.nl (Tygo Jedema)
    Version: 0.0.3
    Older version: 0.0.2
    Version desc: Added infinite scroll, enhanced carousel functionality, improved zoom/pan behavior and reworked some css.
    --------------------------------------------------------------------
    Dependencies:
    - jQuery
    --------------------------------------------------------------------
    Overview:
    Velisoft Image Library provides a modern fullscreen image viewer with carousel, zoom, pan, swipe, and autoplay features. 
    It supports both galleries and single images, with optional UI controls you can turn on or off.
    --------------------------------------------------------------------
    Features:
    - Fullscreen image viewing
    - Carousel navigation for galleries
    - Swipe gestures (touch and mouse)
    - Zoom in/out and pan when zoomed
    - Autoplay slideshow
    - Optional UI controls (counter, zoom, fullscreen, autoplay)
    - Keyboard and mouse navigation
    --------------------------------------------------------------------
    Usage:
    Add the attribute data-velisoft-img-lib to a container above the images next to a src or title atribute (works on body aswell to apply to full website). 
    Then add the class gallery_image to the images you want to include in the library and voila you are set.
    --------------------------------------------------------------------
    Important note:
    Ensure that the images have the exact gallery_image class for the library to recognize them as images for the library.
    --------------------------------------------------------------------
    Example (Gallery Images): 
    <div data-velisoft-img-lib="gallery">
        <img src="/img1.jpg" alt="Image 1" class="gallery_image">
        <img src="/img2.jpg" alt="Image 2" class="gallery_image">
        <img src="/img3.jpg" alt="Image 3" class="gallery_image">
    </div>

    Example (Single Image): 
    <div data-velisoft-img-lib="single">
        <img src="/img3.jpg" alt="Single Image" class="gallery_image">
    </div>

    Example (Gallery Images with controls): 
    <div data-velisoft-img-lib="gallery" data-velisoft-img-libcontrols="true">
        <img src="/img3.jpg" alt="Single Image" class="gallery_image">
    </div>

    Example (Single Image without controls): 
    <div data-velisoft-img-lib="single" data-velisoft-img-libcontrols="false">
        <img src="/img3.jpg" alt="Single Image" class="gallery_image">
    </div>
    --------------------------------------------------------------------
    Sidenotes:
    Single will have not thumbnails, autoplay, and fullscreen controls enabled. 
    False will turn off the zoom, pan, autoplay, and fullscreen controls in the fullscreen container.
    --------------------------------------------------------------------
    Linking (example):
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="/PATHTOYOURJSFILES/velisoft-img-lib.js"></script>
    <link rel="stylesheet" href="/PATHTOYOURCSSFILES/velisoft-img-lib.css" type="text/css">
    --------------------------------------------------------------------
*/

let currentImageIndex=0,currentImages=[],isDraggingX=!1,startPosX=0,currentTranslateX=0,prevTranslateX=0,hasDraggedX=!1,isDraggingY=!1,startPosY=0,currentTranslateY=0,hasDraggedY=!1,closeAnimationDuration=300;const swipeDownThreshold=100;let notificationTimeout,carouselTransitionDuration=300,isFullscreenOperationInProgress=!1,autoplayInterval=null,isAutoplayActive=!1;const autoplayDuration=3e3;let progressBarTimeout,isZoomed=!1,currentZoomLevel=1;const maxZoomLevel=2.5;let zoomPanX=0,zoomPanY=0,zoomStartPointerX=0,zoomStartPointerY=0,isPanning=!1,$currentZoomableImage=null,initialScrollY=0,fullscreenContentScrollTop=0,carouselOffsetIndex=1,carouselItemWidth=0;function getTranslateX(e){const n=window.getComputedStyle(e[0]);return new WebKitCSSMatrix(n.transform).m41}function getTransformValues(e){const n=window.getComputedStyle(e[0]),t=new WebKitCSSMatrix(n.transform);return{scaleX:t.a,scaleY:t.d,translateX:t.e,translateY:t.f}}function renderThumbnails(){const e=$("#thumbnail_container");e.empty(),currentImages.length>1?(currentImages.forEach(((n,t)=>{const o=$("<img>").attr("src",$(n).attr("src")).attr("alt",$(n).attr("alt")||`Thumbnail ${t+1}`).addClass("thumbnail_image");t===currentImageIndex&&o.addClass("active"),o.on("click",(function(e){e.stopPropagation(),isZoomed&&resetZoom(),isAutoplayActive&&stopAutoplay();let n=t,o=n-currentImageIndex;currentImages.length>1&&Math.abs(o)>currentImages.length/2&&(o>0?o-=currentImages.length:o+=currentImages.length),currentImageIndex=n,animateSlide(o)})),e.append(o)})),e.show()):e.hide()}function updateImageCounter(){const e=currentImageIndex%currentImages.length+1;$("#currentImageCount").text(e)}function setupCarouselImages(){const e=$("#carousel_slider");if(e.empty(),0===currentImages.length)return;resetZoom();const n=Math.max(3,currentImages.length),t=[];for(let e=n;e>0;e--)t.push(currentImages[currentImages.length-e]);t.push(...currentImages);for(let e=0;e<n;e++)t.push(currentImages[e]);t.forEach(((n,t)=>{const o=$(n).clone().removeClass("gallery_image").addClass("carousel_image").attr("draggable","false").attr("data-original-index",currentImages.indexOf(n));e.append(o)})),e.css("transition","none"),setTimeout((()=>{const t=e.find(".carousel_image"),o=$(t[n+currentImageIndex]);if(e.find(".carousel_image").removeClass("current_active"),!o.length)return;o.addClass("current_active"),$currentZoomableImage=o;const a=$("#carousel_wrapper").outerWidth(),r=o.outerWidth(!0);let s=0;o.prevAll(".carousel_image").each((function(){s+=$(this).outerWidth(!0)}));const i=-(s+r/2-a/2);e.css("transform",`translateX(${i}px)`),prevTranslateX=i,e.css("transition",`transform ${carouselTransitionDuration/1e3}s ease`),$("#fullscreen_title").text($(currentImages[currentImageIndex]).attr("alt")||""),renderThumbnails(),updateImageCounter()}),0)}function animateSlide(e){if(0===currentImages.length)return;if(isZoomed)return;isAutoplayActive&&Math.abs(e)>0&&startProgressBar(),resetZoom();const n=$("#carousel_slider"),t=n.find(".carousel_image.current_active");if(0===t.length)return void setupCarouselImages();const o=t.outerWidth(!0),a=prevTranslateX-e*o;n.css("transition",`transform ${carouselTransitionDuration/1e3}s ease`),n.css("transform",`translateX(${a}px)`),prevTranslateX=a,n.one("transitionend",(()=>{const e=Math.max(3,currentImages.length),t=n.find(".carousel_image"),o=t.index(n.find(".carousel_image.current_active"));if(o<=e-1){const e=o+currentImages.length,a=$(t[e]);n.find(".carousel_image").removeClass("current_active"),a.addClass("current_active"),$currentZoomableImage=a;const r=$("#carousel_wrapper").outerWidth(),s=a.outerWidth(!0);let i=0;a.prevAll(".carousel_image").each((function(){i+=$(this).outerWidth(!0)}));const l=-(i+s/2-r/2);n.css("transition","none"),n.css("transform",`translateX(${l}px)`),prevTranslateX=l,setTimeout((()=>{n.css("transition",`transform ${carouselTransitionDuration/1e3}s ease`)}),50)}else if(o>=t.length-e){const e=o-currentImages.length,a=$(t[e]);n.find(".carousel_image").removeClass("current_active"),a.addClass("current_active"),$currentZoomableImage=a;const r=$("#carousel_wrapper").outerWidth(),s=a.outerWidth(!0);let i=0;a.prevAll(".carousel_image").each((function(){i+=$(this).outerWidth(!0)}));const l=-(i+s/2-r/2);n.css("transition","none"),n.css("transform",`translateX(${l}px)`),prevTranslateX=l,setTimeout((()=>{n.css("transition",`transform ${carouselTransitionDuration/1e3}s ease`)}),50)}renderThumbnails(),updateImageCounter()}))}function slideNext(){if(isZoomed)return;currentImageIndex=(currentImageIndex+1)%currentImages.length;const e=$("#carousel_slider"),n=e.find(".carousel_image.current_active"),t=e.find(".carousel_image"),o=t.index(n),a=$(t[o+1]);a.length&&(e.find(".carousel_image").removeClass("current_active"),a.addClass("current_active"),$currentZoomableImage=a),animateSlide(1)}function slidePrev(){if(isZoomed)return;currentImageIndex=(currentImageIndex-1+currentImages.length)%currentImages.length;const e=$("#carousel_slider"),n=e.find(".carousel_image.current_active"),t=e.find(".carousel_image"),o=t.index(n),a=$(t[o-1]);a.length&&(e.find(".carousel_image").removeClass("current_active"),a.addClass("current_active"),$currentZoomableImage=a),animateSlide(-1)}function showNotification(){clearTimeout(notificationTimeout),$("#fullscreen_notification").addClass("show"),notificationTimeout=setTimeout((()=>{$("#fullscreen_notification").removeClass("show")}),3e3)}function startProgressBar(){const e=$("#autoplay_progress_bar"),n=$("#autoplay_progress_bar_container");clearTimeout(progressBarTimeout),e.css({transition:"none",width:"0%"}),n.css("display","block").addClass("active"),e[0].offsetWidth,e.css({transition:`width ${autoplayDuration/1e3}s linear`,width:"100%"}),progressBarTimeout=setTimeout((()=>{n.removeClass("active")}),autoplayDuration-50)}function resetProgressBar(){const e=$("#autoplay_progress_bar"),n=$("#autoplay_progress_bar_container");clearTimeout(progressBarTimeout),e.css({transition:"none",width:"0%"}),n.removeClass("active").css("display","none")}function startAutoplay(){currentImages.length<=1||isZoomed||(isAutoplayActive=!0,$("#play_button").addClass("active"),autoplayInterval&&clearInterval(autoplayInterval),autoplayInterval=setInterval((()=>{slideNext(),startProgressBar()}),autoplayDuration),startProgressBar())}function stopAutoplay(){isAutoplayActive=!1,$("#play_button").removeClass("active"),autoplayInterval&&(clearInterval(autoplayInterval),autoplayInterval=null),resetProgressBar()}function applyZoomTransform(){if(!$currentZoomableImage||!$currentZoomableImage.length)return;$currentZoomableImage.toggleClass("zoomed",isZoomed);const e=$currentZoomableImage.closest("#carousel_wrapper, #single_image_area");if(!e.length)return;const n=e.innerWidth(),t=e.innerHeight(),o=$currentZoomableImage.width(),a=$currentZoomableImage.height(),r=o*currentZoomLevel,s=a*currentZoomLevel,i=Math.max(0,(r-n)/2/currentZoomLevel),l=Math.max(0,(s-t)/2/currentZoomLevel);zoomPanX=Math.max(-i,Math.min(i,zoomPanX)),zoomPanY=Math.max(-l,Math.min(l,zoomPanY)),targetPanX=Math.max(-i,Math.min(i,targetPanX)),targetPanY=Math.max(-l,Math.min(l,targetPanY)),$currentZoomableImage.css({transition:isPanning?"none":"transform 0.1s ease-out",transform:`scale(${currentZoomLevel}) translate(${zoomPanX}px, ${zoomPanY}px)`}),isZoomed?($("#zoom_button").addClass("active"),$(".nav_button").prop("disabled",!0),$("#thumbnail_container").addClass("disabled"),$("#play_button").prop("disabled",!0),stopAutoplay()):($("#zoom_button").removeClass("active"),$(".nav_button").prop("disabled",!1),$("#thumbnail_container").removeClass("disabled"),$("#play_button").prop("disabled",!1))}function toggleZoom(){$currentZoomableImage&&$currentZoomableImage.length?isZoomed?(currentZoomLevel=1,zoomPanX=0,zoomPanY=0,targetPanX=0,targetPanY=0,currentPanX=0,currentPanY=0,isZoomed=!1,applyZoomTransform()):(currentZoomLevel=2.5,targetPanX=zoomPanX,targetPanY=zoomPanY,currentPanX=zoomPanX,currentPanY=zoomPanY,isZoomed=!0,applyZoomTransform()):console.warn("No current image found for zooming.")}function resetZoom(){isZoomed&&(currentZoomLevel=1,zoomPanX=0,zoomPanY=0,targetPanX=0,targetPanY=0,currentPanX=0,currentPanY=0,isZoomed=!1,panningAnimationId&&(cancelAnimationFrame(panningAnimationId),panningAnimationId=null),$currentZoomableImage&&$currentZoomableImage.length&&($currentZoomableImage.css({transition:"transform 0.2s ease-out",transform:"scale(1) translate(0px, 0px)"}),$currentZoomableImage.removeClass("zoomed")),$("#zoom_button").removeClass("active"),$(".nav_button").prop("disabled",!1),$("#thumbnail_container").removeClass("disabled"),$("#play_button").prop("disabled",!1))}let isDragging=!1,lastX=0,lastY=0,velocityX=0,velocityY=0,panningAnimationId=null,smoothPanTimeout=null,targetPanX=0,targetPanY=0,currentPanX=0,currentPanY=0;const panSmoothness=.15,velocityDecay=.92,minVelocity=.05;function smoothPanAnimation(){if(!isZoomed||isPanning)return;const e=targetPanX-currentPanX,n=targetPanY-currentPanY;Math.abs(e)>.1||Math.abs(n)>.1?(currentPanX+=e*panSmoothness,currentPanY+=n*panSmoothness,zoomPanX=currentPanX,zoomPanY=currentPanY,applyZoomTransform(),panningAnimationId=requestAnimationFrame(smoothPanAnimation)):(currentPanX=targetPanX,currentPanY=targetPanY,zoomPanX=currentPanX,zoomPanY=currentPanY,applyZoomTransform(),panningAnimationId=null)}function applyInertia(){!isDragging&&(Math.abs(velocityX)>.05||Math.abs(velocityY)>.05)&&(targetPanX+=velocityX,targetPanY+=velocityY,velocityX*=.92,velocityY*=.92,panningAnimationId||smoothPanAnimation(),requestAnimationFrame(applyInertia))}function resetInteractionStates(){isDraggingX=!1,isDraggingY=!1,isPanning=!1,hasDraggedX=!1,hasDraggedY=!1,startPosX=void 0,startPosY=void 0,currentTranslateX=0,currentTranslateY=0}function closeFullscreenLibrary(){$("#fullscreen_container").fadeOut((function(){$("body").css({position:"",top:"",width:"",overflow:""}),window.scrollTo(0,initialScrollY),stopAutoplay(),resetZoom(),fullscreenContentScrollTop=0,$("#carousel_slider").empty(),$("#thumbnail_container").empty(),resetInteractionStates(),$("#fullscreen_container").removeClass("dragging no-select"),$("#fullscreen_content").css({transition:"",transform:"translateY(0px)"}),$("#carousel_slider").css({transition:"",transform:""})}))}function toggleNativeFullscreen(e){if(e)if(document.fullscreenElement){isFullscreenOperationInProgress=!0;const e=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.msExitFullscreen;e&&e.call(document).then((()=>{const e=$("#carousel_wrapper").is(":visible")?$("#carousel_wrapper")[0]:$("#single_image_area")[0];e&&(e.scrollTop=fullscreenContentScrollTop)})).catch((e=>{console.error("Fullscreen exit failed:",e),isFullscreenOperationInProgress=!1}))}else{isFullscreenOperationInProgress=!0;const n=$("#carousel_wrapper").is(":visible")?$("#carousel_wrapper")[0]:$("#single_image_area")[0];n&&(fullscreenContentScrollTop=n.scrollTop);const t=e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullscreen||e.msRequestFullscreen;t&&t.call(e).then((()=>{const e=$("#carousel_wrapper").is(":visible")?$("#carousel_wrapper")[0]:$("#single_image_area")[0];e&&setTimeout((()=>{e.scrollTop=fullscreenContentScrollTop}),50)})).catch((e=>{console.error("Fullscreen request failed:",e),isFullscreenOperationInProgress=!1}))}}function applyControlVisibility(e){const n=e.data("velisoft-img-libcontrols");let t=!1;!1===n||"false"===n?t=!0:!0!==n&&"true"!==n||(t=!1);const o={"#imageCounter":"flex","#autoplay_progress_bar_container":"block","#zoom_button":"flex","#fullerscreen_button":"flex","#play_button":"flex"};for(const e in o){const n=$(e),a=o[e];t?n.css("display","none"):n.css("display",a)}}$("#carousel_wrapper, #single_image_area").on("mousedown touchstart",(function(e){if(!isZoomed)return;e.preventDefault(),isDragging=!0,isPanning=!0,panningAnimationId&&(cancelAnimationFrame(panningAnimationId),panningAnimationId=null);const n="touchstart"===e.type?e.originalEvent.touches[0]:e;lastX=n.clientX,lastY=n.clientY,currentPanX=zoomPanX,currentPanY=zoomPanY,targetPanX=zoomPanX,targetPanY=zoomPanY,velocityX=0,velocityY=0})).on("mousemove touchmove",(function(e){if(!isDragging||!isZoomed)return;e.preventDefault();const n="touchmove"===e.type?e.originalEvent.touches[0]:e,t=n.clientX,o=n.clientY,a=t-lastX,r=o-lastY;targetPanX+=a,targetPanY+=r,velocityX=.8*a,velocityY=.8*r,lastX=t,lastY=o,panningAnimationId||smoothPanAnimation()})).on("mouseup touchend mouseleave touchcancel",(function(e){isDragging&&(isDragging=!1,isPanning=!1,(Math.abs(velocityX)>.05||Math.abs(velocityY)>.05)&&applyInertia())})),$("#carousel_wrapper, #single_image_area").on("wheel",(function(e){if(!$currentZoomableImage||!$currentZoomableImage.length)return;const n=e.originalEvent,t=n.deltaX,o=n.deltaY;if(Math.abs(t)>Math.abs(o)&&Math.abs(t)>10&&!isZoomed)return e.preventDefault(),window.trackpadScrollTimeout&&clearTimeout(window.trackpadScrollTimeout),void(window.trackpadScrollTimeout=setTimeout((()=>{t>0?slideNext():slidePrev()}),150));if(isZoomed){e.preventDefault();const t=-o>0?1.1:.9,a=Math.min(2.5,Math.max(1,currentZoomLevel*t)),r=$currentZoomableImage[0].getBoundingClientRect(),s=n.clientX-r.left,i=n.clientY-r.top,l=s/r.width,c=i/r.height,u=currentZoomLevel;currentZoomLevel=a;const m=currentZoomLevel/u;zoomPanX-=(l-.5)*$currentZoomableImage.width()*(m-1),zoomPanY-=(c-.5)*$currentZoomableImage.height()*(m-1),targetPanX=zoomPanX,targetPanY=zoomPanY,currentPanX=zoomPanX,currentPanY=zoomPanY,isZoomed=currentZoomLevel>1,applyZoomTransform()}else if(Math.abs(o)>Math.abs(t)){e.preventDefault();const t=-o>0?1.1:.9,a=Math.min(2.5,Math.max(1,currentZoomLevel*t)),r=$currentZoomableImage[0].getBoundingClientRect(),s=n.clientX-r.left,i=n.clientY-r.top,l=s/r.width,c=i/r.height,u=currentZoomLevel;currentZoomLevel=a;const m=currentZoomLevel/u;zoomPanX-=(l-.5)*$currentZoomableImage.width()*(m-1),zoomPanY-=(c-.5)*$currentZoomableImage.height()*(m-1),targetPanX=zoomPanX,targetPanY=zoomPanY,currentPanX=zoomPanX,currentPanY=zoomPanY,isZoomed=currentZoomLevel>1,applyZoomTransform()}})),document.addEventListener("fullscreenchange",(e=>{if(document.fullscreenElement){$("body").addClass("image-fullscreen-active"),showNotification();const e=$("#carousel_wrapper").is(":visible")?$("#carousel_wrapper")[0]:$("#single_image_area")[0];document.fullscreenElement===$("#fullscreen_content")[0]&&e&&setTimeout((()=>{e.scrollTop=fullscreenContentScrollTop}),50)}else{$("body").removeClass("image-fullscreen-active"),clearTimeout(notificationTimeout),$("#fullscreen_notification").removeClass("show");const e=$("#carousel_wrapper").is(":visible")?$("#carousel_wrapper")[0]:$("#single_image_area")[0];e&&$("#fullscreen_container").is(":visible")&&setTimeout((()=>{e.scrollTop=fullscreenContentScrollTop}),50)}setTimeout((()=>{isFullscreenOperationInProgress=!1}),50)})),$(document).ready((function(){resetInteractionStates(),0===$("#fullscreen_container").length&&$("body").append('<div id="fullscreen_container">\n                <div id="imageCounter">\n                    <span id="currentImageCount">1</span> / <span id="totalImageCount"></span>\n                </div>\n                <div id="fullscreen_notification">Press "ESC" to exit</div>\n\n                <div id="autoplay_progress_bar_container">\n                    <div id="autoplay_progress_bar"></div>\n                </div>\n\n                <div id="full-buttons_container">\n                    <button id="zoom_button">\n                        <svg class="zoom-in-icon" width="35" height="35" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">\n                            <circle cx="11" cy="11" r="8" />\n                            <line x1="11" y1="8" x2="11" y2="14" />\n                            <line x1="8" y1="11" x2="14" y2="11" />\n                            <line x1="21" y1="21" x2="16.65" y2="16.65" />\n                        </svg>\n                        <svg class="zoom-out-icon" width="35" height="35" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">\n                            <circle cx="11" cy="11" r="8" />\n                            <line x1="8" y1="11" x2="14" y2="11" />\n                            <line x1="21" y1="21" x2="16.65" y2="16.65" />\n                        </svg>\n                    </button>\n                    <button id="fullerscreen_button">\n                        <svg width="30" height="30" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">\n                            <path d="M4 4H9V2H2V9H4V4Z" fill="currentColor"/>\n                            <path d="M20 4H15V2H22V9H20V4Z" fill="currentColor"/>\n                            <path d="M4 20H9V22H2V15H4V20Z" fill="currentColor"/>\n                            <path d="M20 20H15V22H22V15H20V20Z" fill="currentColor"/>\n                        </svg>\n                    </button>\n                    <button id="play_button">\n                        <svg class="play-icon" width="35" height="35" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">\n                            <polygon points="8,5 19,12 8,19" />\n                        </svg>\n                        <svg class="pause-icon" width="35" height="35" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">\n                            <rect x="6" y="5" width="4" height="14"/>\n                            <rect x="14" y="5" width="4" height="14"/>\n                        </svg>\n                    </button>\n                    <button id="closing_button">\n                        <svg width="35" height="35" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                            <path d="M6 18L18 6M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n                        </svg>\n                    </button>\n                </div>\n\n                <div id="fullscreen_content">\n                    <div id="carousel_area">\n                        <div id="carousel_wrapper">\n                            <div id="carousel_slider"></div>\n                        </div>\n                        <p id="fullscreen_title"></p>\n                        <div id="thumbnail_container"></div>\n                        <button id="prev_button" class="nav_button">\n                            <svg width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">\n                                <polyline points="15 18 9 12 15 6"/>\n                            </svg>\n                        </button>\n                        <button id="next_button" class="nav_button">\n                            <svg width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">\n                                <polyline points="9 18 15 12 9 6"/>\n                            </svg>\n                        </button>\n                    </div>\n                    <div id="single_image_area" style="display: none;">\n                        <img id="single_fullscreen_image" src="" alt="" class="fullscreen_image">\n                        <p id="single_fullscreen_title"></p>\n                    </div>\n                </div>\n            </div>\n            '),$("[data-velisoft-img-lib]").on("click",".gallery_image",(function(e){if(isDraggingX||isDraggingY||isPanning||(hasDraggedX=!1,hasDraggedY=!1),hasDraggedX||hasDraggedY)return hasDraggedX=!1,hasDraggedY=!1,void e.preventDefault();initialScrollY=window.scrollY||window.pageYOffset,$("body").css({position:"fixed",top:`-${initialScrollY}px`,width:"100%",overflow:"hidden"});const n=$(this),t=n.closest("[data-velisoft-img-lib]"),o=t.data("velisoft-img-lib");if($("#imageCounter, #autoplay_progress_bar_container, #zoom_button, #fullerscreen_button, #play_button, .nav_button, #thumbnail_container").hide(),$("#carousel_area").hide(),$("#single_image_area").hide(),"gallery"===o)currentImages=t.find(".gallery_image").toArray(),currentImageIndex=currentImages.indexOf(n[0]),$("#carousel_area").show(),$(".nav_button").show(),$("#thumbnail_container").show(),setupCarouselImages(),fullscreenContentScrollTop=$("#carousel_wrapper")[0].scrollTop;else{currentImages=[n[0]],currentImageIndex=0,$("#single_image_area").show();const e=n.attr("src"),t=n.attr("alt")||"",o=$("#single_fullscreen_image");o.attr("src",e).attr("alt",t),$currentZoomableImage=o,$(".nav_button").hide(),$("#thumbnail_container").empty().hide(),$("#carousel_slider").empty(),fullscreenContentScrollTop=$("#single_image_area")[0].scrollTop}applyControlVisibility(t),$("#totalImageCount").text(currentImages.length),updateImageCounter(),$("#fullscreen_container").fadeIn(),$("#fullscreen_content").css("transform","translateY(0px)"),stopAutoplay(),resetZoom()})),$(document).on("click","#closing_button",(function(e){e.stopPropagation(),closeFullscreenLibrary()})),$(document).on("click","#fullerscreen_button",(function(e){e.stopPropagation();const n=$("#fullscreen_content")[0];n&&toggleNativeFullscreen(n)})),$(document).on("click","#play_button",(function(e){e.stopPropagation(),isZoomed||(isAutoplayActive?stopAutoplay():startAutoplay())})),$(document).on("click","#zoom_button",(function(e){e.stopPropagation(),toggleZoom()})),$(document).on("dblclick","#carousel_wrapper, #single_image_area",(function(e){e.preventDefault(),toggleZoom()})),$(document).on("keydown",(function(e){"Escape"!==e.key&&27!==e.keyCode||(isZoomed?resetZoom():document.fullscreenElement?document.exitFullscreen():$("#fullscreen_container").is(":visible")&&closeFullscreenLibrary())})),$(document).on("click","#prev_button",(function(e){e.stopPropagation(),isZoomed||slidePrev()})),$(document).on("click","#next_button",(function(e){e.stopPropagation(),isZoomed||slideNext()})),$(document).on("mousedown touchstart","#carousel_wrapper",(function(e){if(isZoomed){isPanning=!0,$currentZoomableImage.addClass("panning no-select");const n=e.clientX||e.originalEvent.touches[0].clientX,t=e.clientY||e.originalEvent.touches[0].clientY;zoomStartPointerX=n-zoomPanX,zoomStartPointerY=t-zoomPanY,e.preventDefault()}else if("mousedown"===e.type){const n=e.clientX,t=e.clientY;startPosX=n,startPosY=t,$("#fullscreen_container").addClass("no-select"),$("#carousel_slider").css("transition","none"),stopAutoplay(),e.preventDefault()}else{const n=e.originalEvent.touches[0].clientX,t=e.originalEvent.touches[0].clientY;startPosX=n,startPosY=t,$("#fullscreen_container").addClass("no-select"),$("#carousel_slider").css("transition","none"),stopAutoplay()}})),$(document).on("mousedown touchstart","#single_image_area",(function(e){if(isZoomed){isPanning=!0,$("#single_fullscreen_image").addClass("panning no-select");const n=e.clientX||e.originalEvent.touches[0].clientX,t=e.clientY||e.originalEvent.touches[0].clientY;zoomStartPointerX=n-zoomPanX,zoomStartPointerY=t-zoomPanY,e.preventDefault()}else{const n=e.clientX||e.originalEvent.touches[0].clientX,t=e.clientY||e.originalEvent.touches[0].clientY;startPosX=n,startPosY=t,$("#fullscreen_container").addClass("no-select")}})),$(document).on("mousemove touchmove",(function(e){if(isPanning){const n=e.clientX||e.originalEvent.touches[0].clientX,t=e.clientY||e.originalEvent.touches[0].clientY;zoomPanX=n-zoomStartPointerX,zoomPanY=t-zoomStartPointerY,applyZoomTransform()}else if(isDraggingX){const n="mousemove"===e.type?e.clientX:e.originalEvent.touches[0].clientX;currentTranslateX=prevTranslateX+(n-startPosX),$("#carousel_slider").css("transform",`translateX(${currentTranslateX}px)`),Math.abs(n-startPosX)>10&&(hasDraggedX=!0)}else if(isDraggingY){const n="mousemove"===e.type?e.clientY:e.originalEvent.touches[0].clientY;currentTranslateY=n-startPosY,$("#fullscreen_content").css("transform",`translateY(${currentTranslateY}px)`),Math.abs(n-startPosY)>10&&(hasDraggedY=!0)}else if(!isZoomed&&void 0!==startPosX&&void 0!==startPosY){const n="mousemove"===e.type?e.clientX:e.originalEvent.touches[0].clientX,t="mousemove"===e.type?e.clientY:e.originalEvent.touches[0].clientY,o=Math.abs(n-startPosX),a=Math.abs(t-startPosY);(o>15||a>15)&&(a>o?(isDraggingY=!0,$("#fullscreen_container").addClass("dragging"),$("#fullscreen_content").css("transition","none"),currentTranslateY=t-startPosY,$("#fullscreen_content").css("transform",`translateY(${currentTranslateY}px)`),hasDraggedY=!0):(isDraggingX=!0,$("#fullscreen_container").addClass("dragging"),$("#carousel_wrapper").addClass("dragging"),currentTranslateX=prevTranslateX+(n-startPosX),$("#carousel_slider").css("transform",`translateX(${currentTranslateX}px)`),hasDraggedX=!0))}})),$(document).on("mouseup touchend mouseleave",(function(e){if(isPanning)isPanning=!1,$currentZoomableImage&&$currentZoomableImage.removeClass("panning no-select"),applyZoomTransform();else if(isDraggingX){isDraggingX=!1,$("#fullscreen_container").removeClass("dragging no-select"),$("#carousel_wrapper").removeClass("dragging no-select");const n=("mouseup"===e.type||"mouseleave"===e.type?e.clientX:e.originalEvent.changedTouches[0].clientX)-startPosX,t=50,o=$("#carousel_slider"),a=o.find(".carousel_image.current_active");if(0===a.length)return void setupCarouselImages();if(n>t){currentImageIndex=(currentImageIndex-1+currentImages.length)%currentImages.length;const e=o.find(".carousel_image"),n=e.index(a),t=$(e[n-1]);t.length&&(o.find(".carousel_image").removeClass("current_active"),t.addClass("current_active"),$currentZoomableImage=t),animateSlide(-1)}else if(n<-t){currentImageIndex=(currentImageIndex+1)%currentImages.length;const e=o.find(".carousel_image"),n=e.index(a),t=$(e[n+1]);t.length&&(o.find(".carousel_image").removeClass("current_active"),t.addClass("current_active"),$currentZoomableImage=t),animateSlide(1)}else animateSlide(0);resetInteractionStates()}else if(isDraggingY){isDraggingY=!1,$("#fullscreen_container").removeClass("dragging no-select");const n=("mouseup"===e.type||"mouseleave"===e.type?e.clientY:e.originalEvent.changedTouches[0].clientY)-startPosY;Math.abs(n)>60?(hasDraggedY=!0,closeFullscreenLibrary(),setTimeout((()=>{resetInteractionStates()}),100)):($("#fullscreen_content").css({transition:`transform ${closeAnimationDuration/1e3}s ease-out`,transform:"translateY(0px)"}),hasDraggedY=!1,resetInteractionStates())}else $("#fullscreen_container").removeClass("no-select dragging"),resetInteractionStates();setTimeout((()=>{$("#carousel_slider").css("transition",`transform ${carouselTransitionDuration/1e3}s ease`)}),50)})),$(document).on("mouseleave","#carousel_wrapper",(function(e){(isDraggingX||isDraggingY)&&(isDraggingX=!1,isDraggingY=!1,$("#fullscreen_container").removeClass("dragging no-select"),$("#carousel_wrapper").removeClass("dragging no-select"),hasDraggedX&&animateSlide(0),hasDraggedY&&$("#fullscreen_content").css({transition:`transform ${closeAnimationDuration/1e3}s ease-out`,transform:"translateY(0px)"}),resetInteractionStates(),setTimeout((()=>{$("#carousel_slider").css("transition",`transform ${carouselTransitionDuration/1e3}s ease`)}),50))})),$(document).on("dragstart",".no-select",(function(e){e.preventDefault()})),$(document).on("click","#fullscreen_container",(function(e){const n=$(e.target),t=["#carousel_wrapper","#single_image_area","#full-buttons_container","#thumbnail_container",".nav_button","#imageCounter","#autoplay_progress_bar_container","#fullscreen_notification","#fullscreen_title"];let o=!1;for(const e of t)if(n.closest(e).length){o=!0;break}o||closeFullscreenLibrary()}))}));